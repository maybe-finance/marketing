<section class="p-6" data-controller="insider-trades">
  <% if tool.symbol.present? %>
    <div class="flex flex-col md:flex-row justify-between mb-8 gap-6">
      <div>
        <h2 class="text-2xl font-medium"><%= tool.company_name %></h2>
        <p class="text-gray-500">Insider trading activity</p>
      </div>

      <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
        <div class="bg-gray-50 p-4 rounded-lg">
          <p class="text-sm text-gray-500">Total Value</p>
          <p class="text-xl font-medium"><%= number_to_currency(tool.total_value) %></p>
        </div>
        
        <div class="bg-gray-50 p-4 rounded-lg">
          <p class="text-sm text-gray-500">Total Shares</p>
          <p class="text-xl font-medium"><%= number_with_delimiter(tool.total_shares) %></p>
        </div>

        <div class="bg-gray-50 p-4 rounded-lg col-span-2 md:col-span-1">
          <p class="text-sm text-gray-500">Avg. Trade Value</p>
          <p class="text-xl font-medium">
            <%= number_to_currency(tool.total_value / tool.insider_trades.size) %>
          </p>
        </div>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
      <% if tool.top_trader %>
        <div class="bg-white p-4 rounded-lg border border-gray-200">
          <h3 class="text-sm font-medium text-gray-500 mb-1">Most Active Insider</h3>
          <p class="text-lg font-medium"><%= tool.top_trader[:name].titleize %></p>
          <p class="text-sm text-gray-500">
            Total Activity: <%= number_to_currency(tool.top_trader[:value], precision: 0) %>
          </p>
        </div>
      <% end %>

      <% if tool.largest_transaction %>
        <div class="bg-white p-4 rounded-lg border border-gray-200">
          <h3 class="text-sm font-medium text-gray-500 mb-1">Largest Single Transaction</h3>
          <p class="text-lg font-medium">
            <%= number_to_currency(tool.largest_transaction[:value].abs, precision: 0) %>
          </p>
          <p class="text-sm text-gray-500">
            by <%= tool.largest_transaction[:full_name].titleize %> on 
            <%= Date.parse(tool.largest_transaction[:date_reported]).strftime("%b %-d, %Y") %>
          </p>
        </div>
      <% end %>

      <div class="bg-white p-4 rounded-lg border border-gray-200">
        <h3 class="text-sm font-medium text-gray-500 mb-1">30-Day Activity</h3>
        <p class="text-lg font-medium">
          <%= pluralize(tool.recent_trend[:count], 'Transaction') %>
        </p>
        <p class="text-sm text-gray-500">
          Volume: <%= number_with_delimiter(tool.recent_trend[:volume].abs) %> shares
          <br>
          Value: <%= number_to_currency(tool.recent_trend[:value].abs, precision: 0) %>
        </p>
      </div>
    </div>
  <% else %>
    <div class="flex flex-col md:flex-row justify-between mb-8 gap-6">
      <div>
        <h2 class="text-2xl font-medium"><%= tool.company_name %></h2>
      </div>
      <div class="flex gap-4 mb-6">
        <%= link_to top_owners_tool_path(slug: "inside-trading-tracker"), 
            class: "text-sm text-gray-600 hover:text-blue-600 flex items-center gap-1 #{action_name == 'owners' ? 'text-blue-600' : ''}",
            data: { turbo_frame: "_top" } do %>
          <%= lucide_icon "users", class: "w-4 h-4" %>
          Top 10% Owner Trades
        <% end %>

        <%= link_to biggest_trades_tool_path(slug: "inside-trading-tracker"), 
            class: "text-sm text-gray-600 hover:text-blue-600 flex items-center gap-1 #{action_name == 'biggest' ? 'text-blue-600' : ''}",
            data: { turbo_frame: "_top" } do %>
          <%= lucide_icon "trending-up", class: "w-4 h-4" %>
          Biggest Insider Trades
        <% end %>

        <%= link_to top_officers_tool_path(slug: "inside-trading-tracker"), 
            class: "text-sm text-gray-600 hover:text-blue-600 flex items-center gap-1 #{action_name == 'officers' ? 'text-blue-600' : ''}",
            data: { turbo_frame: "_top" } do %>
          <%= lucide_icon "briefcase", class: "w-4 h-4" %>
          Top Officer Trades
        <% end %>
      </div>
    </div>
  <% end %>

  <div class="overflow-x-auto rounded-lg border border-gray-200">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <% columns = ["Name", "Position", "Date", "Shares", "Value", "Holdings","Type"] %>
          <% columns.each do |column| %>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100"
                data-action="click->insider-trades#sort"
                data-column="<%= column.downcase %>">
              <div class="flex items-center gap-1">
                <%= column %>
                <%= lucide_icon "chevrons-up-down", class: "w-4 h-4" %>
              </div>
            </th>
          <% end %>
        </tr>
      </thead>

      <tbody class="bg-white divide-y divide-gray-200" data-insider-trades-target="tableBody">
        <%= render partial: "tools/widgets/content/inside_trading_tracker/trade_row", collection: tool.insider_trades(params[:filter]), as: :trade %>
      </tbody>
    </table>
  </div>

  <div data-insider-trades-target="loading" class="hidden">
    <div class="flex justify-center items-center p-12">
      <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"></div>
    </div>
  </div>
</section>